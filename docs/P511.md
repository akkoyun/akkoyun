# P511AA Data Pack

STF Tarım için geliştirilmekte olan P511AA otomatik filtre kontrol donanımı 01.xx.xx versiyonu düzenlemesi ile birlikte hayata geçirilecek olan veri yapısı teknik detayları aşağıda detaylandırılmıştır. Diğer tüm STF projeleri ile birlikte yapılan planlama doğrultusunda her projeye ait ayrı bir node (API) olması uygun görülmüştür. P511 filtre otomasyon projesi için API **P511AA IoT Data Node** olarak anılacaktır.

## Index

- [P511AA Veri Trafiği](#p511aa-veri-trafiği)
  - [P511AA UML Veri Grafiği](#p511aa-uml-veri-grafiği)
- [Gönderilen Veri Paketleri Yapısı](#gönderilen-veri-paketleri-yapısı)
  - [P511AA-P01 Veri Paketi](#p511aa-p01-veri-paketi)
	- [P01 - Örnek Veri Paketi (Gönderen : P511AA)](#p01---örnek-veri-paketi-gönderen--p511aa)
  - [P511AA-P02 Veri Paketi](#p511aa-p02-veri-paketi)
	- [P02 - Örnek Veri Paketi (Gönderen : P511AA)](#p02---örnek-veri-paketi-gönderen--p511aa)
  - [P511AA-P03 Veri Paketi](#p511aa-p03-veri-paketi)
	- [P03 - Örnek Veri Paketi (Gönderen : P511AA)](#p03---örnek-veri-paketi-gönderen--p511aa)
  - [P511AA-P04 Veri Paketi](#p511aa-p04-veri-paketi)
	- [P04 - Örnek Veri Paketi (Gönderen : P511AA)](#p04---örnek-veri-paketi-gönderen--p511aa)
  - [P511AA-P05 Veri Paketi](#p511aa-p05-veri-paketi)
	- [P05 - Örnek Veri Paketi (Gönderen : P511AA)](#p05---örnek-veri-paketi-gönderen--p511aa)
  - [P511AA-P06 Veri Paketi](#p511aa-p06-veri-paketi)
	- [P06 - Örnek Veri Paketi (Gönderen : P511AA)](#p06---örnek-veri-paketi-gönderen--p511aa)
  - [P511AA-P07 Veri Paketi](#p511aa-p07-veri-paketi)
	- [P07 - Örnek Veri Paketi (Gönderen : P511AA)](#p07---örnek-veri-paketi-gönderen--p511aa)
- [Cevap Veri Paketleri Yapısı](#cevap-veri-paketleri-yapısı)
  - [P511AA-P91 Veri Paketi](#p511aa-p91-veri-paketi)
	- [P91 - Örnek Veri Paketi (Gönderen : Sunucu)](#p91---örnek-veri-paketi-gönderen--sunucu)
  - [P511AA-P92 / P93 / P94 / P95 / P96 Veri Paketi](#p511aa-p92--p93--p94--p95--p96-veri-paketi)
	- [P92 / P93 / P94 / P95 / P96  - Örnek Veri Paketi (Gönderen : Sunucu)](#p92--p93--p94--p95--p96----örnek-veri-paketi-gönderen--sunucu)
  - [P511AA-P96 / P97 Veri Paketi](#p511aa-p96--p97-veri-paketi)
	- [P97 - Örnek Veri Paketi (Gönderen : Sunucu)](#p97---örnek-veri-paketi-gönderen--sunucu)
- [İstem Veri Paketleri Yapısı](#i̇stem-veri-paketleri-yapısı)
  - [P511AA-P83 Veri Paketi](#p511aa-p83-veri-paketi)
	- [P83 - Örnek Veri Paketi (Gönderen : Sunucu)](#p83---örnek-veri-paketi-gönderen--sunucu)
  - [P511AA-P85 Veri Paketi](#p511aa-p85-veri-paketi)
	- [P85 - Örnek Veri Paketi (Gönderen : Sunucu)](#p85---örnek-veri-paketi-gönderen--sunucu)
- [Gönderilen Veri Paketi Değişken Yapısı](#gönderilen-veri-paketi-değişken-yapısı)
  - [1. Device](#1-device)
	- [1.A. : “ID" Numarası](#1a--id-numarası)
	- [1.B. : “Hardware" Versiyonu](#1b--hardware-versiyonu)
	- [1.C. : “Firmware" Versiyonu](#1c--firmware-versiyonu)
	- [1.D. : “FilterCount" Değeri](#1d--filtercount-değeri)
  - [2. Power](#2-power)
	- [2.A. “Firmware"](#2a-firmware)
	- [2.B. “Charger"](#2b-charger)
	- [2.B.1. “Status"](#2b1-status)
	- [2.C. : “Battery"](#2c--battery)
	- [2.C.1. : “IV"](#2c1--iv)
	- [2.C.2. : “T"](#2c2--t)
	- [2.C.3. : “AC"](#2c3--ac)
	- [2.C.4. : “SOC"](#2c4--soc)
	- [2.C.5. : “IB"](#2c5--ib)
	- [2.C.6. : “CYC"](#2c6--cyc)
  - [3- IoT](#3--iot)
	- [3.A. : “GSM"](#3a--gsm)
	- [3.A.1. : “Firmware"](#3a1--firmware)
	- [3.A.2. : “Module"](#3a2--module)
	- [3.A.2.1. : “IMEI"](#3a21--imei)
	- [3.A.3. : “SIM"](#3a3--sim)
	- [3.A.3.1. : “SIM_Type"](#3a31--sim_type)
	- [3.A.3.2. : “ICCID"](#3a32--iccid)
	- [3.A.4. : “Operator"](#3a4--operator)
	- [3.A.4.1. : “Code"](#3a41--code)
	- [3.A.4.2. : “RSSI"](#3a42--rssi)
	- [3.A.4.3. : “Conn_Time"](#3a43--conn_time)
  - [4- Data](#4--data)
	- [4.A. : “TimeStamp"](#4a--timestamp)
	- [4.B. : “Event"](#4b--event)
	- [4.C. : “Status"](#4c--status)
	- [4.D. : “Pin"](#4d--pin)
	- [4.E. : “Pout"](#4e--pout)
	- [4.F. : “Interval"](#4f--interval)
	- [4.G. : “IN"](#4g--in)
	- [4.H. : “OUT"](#4h--out)
	- [4.J. : “Sid"](#4j--sid)
  
***

## P511AA Veri Trafiği

Otomatik filtre kontrol sistemi kurgu gereği çift yönlü veri trafiğine sahip bir sistemdir. Bu kurgu bünyesinde aşağıdaki koşullarda IoT veri transferi yapılacaktır. P511AA donanım kurgusu sürekli uyanık sistem olarak oluşturulmuştur. Bu kurgu gereği sistem devamlı uyanık olarak bekleyecek ve belirlenen koşullar oluşması durumunda veri transferi yapacaktır.

| Pack ID    | Açıklama                                                                     |
|------------|------------------------------------------------------------------------------|
| [P511AA-P01](https://gist.github.com/akkoyun/b89b2d6d9ad01163e824b09f115805eb#p511aa-p01-veri-paketi) | Pompa çalışması ve sulamanın başlaması veri gönderimi                        |
| [P511AA-P02](https://gist.github.com/akkoyun/b89b2d6d9ad01163e824b09f115805eb#p511aa-p02-veri-paketi) | Sulama borularının dolması ve hat basıncının sabitlenmesi veri gönderimi     |
| [P511AA-P03](https://gist.github.com/akkoyun/b89b2d6d9ad01163e824b09f115805eb#p511aa-p03-veri-paketi) | Sunucu tarafından güncelleme istenmesine cevap veri gönderimi                |
| [P511AA-P04](https://gist.github.com/akkoyun/b89b2d6d9ad01163e824b09f115805eb#p511aa-p04-veri-paketi) | Filtre temizleme işlemi sonucu veri gönderimi                                |
| [P511AA-P05](https://gist.github.com/akkoyun/b89b2d6d9ad01163e824b09f115805eb#p511aa-p05-veri-paketi) | Uzaktan filtre temizleme istemi sonucu veri gönderimi                                |
| [P511AA-P06](https://gist.github.com/akkoyun/b89b2d6d9ad01163e824b09f115805eb#p511aa-p06-veri-paketi) | Sulama basıncının düşmeye başlaması ve hat basıncının düşmesi veri gönderimi |
| [P511AA-P07](https://gist.github.com/akkoyun/b89b2d6d9ad01163e824b09f115805eb#p511aa-p07-veri-paketi) | Sulama bitişi veri gönderimi                                                 |

***

### P511AA UML Veri Grafiği

P511AA sisteminde oluşabilecek çoklu koşullar için birden farklı veri paketi oluşmuştur. Bu veri paketleri gönderim sırasında içerisinde yer alan değişkenlerin mükerrer gönderimini engellemek amacı ile optimize edilmiştir. Bu optimizasyon bu dokümanın ileri bölümlerinde tanımlanmıştır.

![P511AA UML Diagram](https://i.imgyukle.com/2020/12/03/YoJVd6.png)

***

## Gönderilen Veri Paketleri Yapısı

### P511AA-P01 Veri Paketi

	Üzerine çalışılacak ve başka bir algoritma çıkartılmaya çalışışacaktır.

Hat basıncının belirlenen seviyeyi aşlması durumunda (planlanan 0.2 Bar basınçtır fakat hat beslemesi yukarı doğru olan durumlarda pompa kapatıldığı an geri gelen su çıkış basıncının düşmesini engelleyebilecektir.) sistemin sulama başlangıcını sunuculara göndermesi için oluşturulmuş veri paketidir. 

**P01** veri paketi cihaz çalışma döngüsü içerisinde sistemin aktif olduğunu belirtir ilk veri paketi olduğı için eksiksiz olarak (tam paket) gönderilecektir. Paket içerisinde yer alan bazı sabit veriler (cihaza has sabitler) bu paket içersinde gönderilecek diğer paketlerde gönderilmeyecektir. 

#### P01 - Örnek Veri Paketi (Gönderen : P511AA)

```json
{
	"Device": {
		"ID": "0001767661",
		"FilterCount": 3,
		"Hardware": "01.00.00",
		"Firmware": "01.06.00"
	},
	"Power": {
		"Firmware": "01.06.01",
		"Charger": {
			"Status": 5
		},
		"Battery": {
			"IV": 3.89,
			"T": 25.43,
			"AC": -51.72,
			"SOC": 17.97,
			"IB": 718,
			"CYC": 32
		}
	},
	"IoT": {
		"GSM": {
			"Firmware": "01.06.01",
			"Module": {
				"IMEI": "353613080341053"
			},
			"SIM": {
				"SIM_Type": 1,
				"Iccid": "8990011901130266075"
			},
			"Operator": {
				"Code": 28601,
				"RSSI": -81,
				"Conn_Time": 22
			}
		}
	},
	"Data": {
		"TimeStamp": "2020-10-23  14:18:28",
		"Event": 121,
	}
}
```

	Değişken detayları aşağıda tanımlanmıştır.

**P01** veri paketine (gönderilen) cevap olarak dönecek cevap paketi olan **P91** aşağıda tanımlanmıştır. 

***

### P511AA-P02 Veri Paketi

**P01** veri paketi gönderimi (koşulların oluşması) durumunda sistem belirlenen periodlarla (ön tanım 30sn) filtre çıkış basıncını ölçümlemeye başlayacaktır. 10 veri okuması ardından (11. veriyi takiben) sistem regresyon kütüphanesi üzerinden 10 geçmiş veriye ait regresyon hesaplaması yaparak veri trend formulünü hesaplamaktadır. Veri trend formülü (y = ax + b) üzerinden trend eğimi anlık olarak hesaplanmaktadır. Bu eğim her yeni ölçüm ile beraber tekrar hesaplanmaktadır.

Hesaplanan basıç regresyon trendi anlık olarak kontrol edilerek %10 (düşürülebilir) belirsizlik dahilinde analiz edilerek sistem basıncının stabil duruma gelip gelmediği (eğimin %10 un altında olması) kontrol edilmektedir. Sistem basıncı oturduğu an ise P02 veri paketi hazırlanarak sunucuya gönderilecektir. 

P02 veri paketi gönderimi durumunda sulama sistemi hat basıncının sabite bindiği anlaşılmaktadır.

#### P02 - Örnek Veri Paketi (Gönderen : P511AA)

```json
{
	"Device": {
		"ID": "0001767661",
	},
	"Power": {
		"Charger": {
			"Status": 5
		},
		"Battery": {
			"IV": 3.89,
			"T": 25.43,
			"AC": -51.72,
			"SOC": 17.97,
			"IB": 718,
			"CYC": 32
		}
	},
	"IoT": {
		"GSM": {
			"Operator": {
				"RSSI": -81
			}
		}
	},
	"Data": {
		"TimeStamp": "2020-10-23  14:18:28",
		"Event": 122,
		"Irrigation": {
			"Status": 102,
			"Pressure": {
				"Pin": 8.123,
				"Pout": 6.123
			},
			"StartDetail": {
				"Interval": 30,
				"IN": [1.12,1.12,1.12,1.12,1.12,1.12,1.12,1.12,1.12,1.12,1.12,1.12,1.12,1.12,1.12,1.12,1.12,1.12,1.12,1.12,1.12,1.12,1.12,1.12,1.12,1.12,1.12,1.12,1.12,1.12,1.12],
				"OUT": [1.12,1.12,1.12,1.12,1.12,1.12,1.12,1.12,1.12,1.12,1.12,1.12,1.12,1.12,1.12,1.12,1.12,1.12,1.12,1.12,1.12,1.12,1.12,1.12,1.12,1.12,1.12,1.12,1.12,1.12,1.12]
			}
		}
	}
}
```

	Değişken detayları aşağıda tanımlanmıştır.

**P02** veri paketine (gönderilen) cevap olarak dönecek cevap paketi olan **P92** aşağıda tanımlanmıştır.

***

### P511AA-P03 Veri Paketi

Sulama sistemi normal çalışma döngüsü içerisinde (herhangi bir filtre kirlenmesi olmadan, herhangi bir temizleme işlemi oluşmadan) P511AA cihazı işlemcisi GSM veri trafiğini devamlı kontrol etmektedir. Bu kontrol sırasında sunucu tarafından bir güncelleme isteği gelmesi durumunda (istek paketi aşağıda verilmiştir) sistem anlık basınç değerlerini sunucuya gönderecektir. 

Sistem GSM iot yapısı gereği sabit IP sistemdir. Bu sabit IP P01 veri paketi geldiği an tesbit edilip sunucu tarafından yapılacak işlemler bu IP üzerinden yapılacaktır (IP hiçbir koşulda değişmemesi beklenmektedir).

	P03 veri paketi P83 istemi üzerine gönderilecektir.

#### P03 - Örnek Veri Paketi (Gönderen : P511AA)

```json
{
	"Device": {
		"ID": "0001767661"
	},
	"Power": {
		"Charger": {
			"Status": 5
		},
		"Battery": {
			"IV": 3.89,
			"T": 25.43,
			"AC": -51.72,
			"SOC": 17.97,
			"IB": 718,
			"CYC": 32
		}
	},
	"IoT": {
		"GSM": {
			"Operator": {
				"RSSI": -81
			}
		}
	},
	"Data": {
		"TimeStamp": "2020-10-23  14:18:28",
		"Event": 260,
		"Irrigation": {
			"Status": 102,
			"Pressure": {
				"Pin": 8.123,
				"Pout": 6.123
			}
		}
	}
}
```

**P03** veri paketine (gönderilen) cevap olarak dönecek cevap paketi olan **P93** aşağıda tanımlanmıştır.

***

### P511AA-P04 Veri Paketi

P511 tarımsal filtre otomasyon sistemi aşağıdaki durumlarda sistem yıkama işlemini gerçekleştirmektedir.

| Yıkama Tipi | Açıklama                                                                                                                |
|-------------|-------------------------------------------------------------------------------------------------------------------------| 
| Otomatik    | Sistem giriş ve çıkış basınçları arasında oluşan basınç farkı eşik değerden fazla ise sistem tarafından otomatik yıkama |
| Manuel      | Sistem üzerinde bulunan manuel yıkama butonuna basılması durumunda                                                      |
| Zamanlı     | Sensör bozulma ihtimalleri doğrultusunda her t sürede bir sistem tarafından gerçekleştirilen yıkama                     |
| Uzaktan     | IoT üzerinden kullanıcının manuel yıkama başlatması durumunda                                                           |

P511AA sistemi yapısı gereği sürekli olarak giriş ve çıkış basıncını ölçmektedir. Bu basın. değerleri ile giriş ve çıkış basınçları arasındaki farkı her ölçümde hesaplamaktadır (delta P). Aynı zamanda her yıkama işlemi sonrasında bir zamanlayıcı resetleyerek yıkama aralıklarını ölçmektedir. Bu parametreler doğrultusunda otomatik yıkama işlemlerine karar vererek temizleme işlemi yapmaktadır. Ayrıca kullanıcı tarafından manuel yıkama komutlarını da dinlemektedir.

Yıkama işlemi başlangıcında sistem giriş ve çıkış basınçlarını (Pin ve Pout) kaydetmekte, yıkama işlemi sırasında ise her kademe yıkama işlemi sonrası giriş ve çıkış basınçları ölçülmektedir. Tüm bu veri setleri paket içerisinde sunuculara gönderilmektedir.  

Yıkama işlemi sonucunda (manuel, otomatik yada zamanlı) P04 veri paketi oluşturulmaktadır. Uzaktan manuel yıkama durumunda ise P05 veri paketi oluşturulacaktır.

#### P04 - Örnek Veri Paketi (Gönderen : P511AA)

```json
{
	"Device": {
		"ID": "0001767661"
	},
	"Power": {
		"Charger": {
			"Status": 5
		},
		"Battery": {
			"IV": 3.89,
			"T": 25.43,
			"AC": -51.72,
			"SOC": 17.97,
			"IB": 718,
			"CYC": 32
		}
	},
	"IoT": {
		"GSM": {
			"Operator": {
				"RSSI": -81
			}
		}
	},
	"Data": {
		"TimeStamp": "2020-10-23  14:18:28",
		"Event": 141,
		"Clean": {
			"Status": 153,
			"Pressure": {
				"Pin": 8.123,
				"Pout": 6.123
			},
			"CleanDetail": [
				{
					"Sid": 1,
					"Pin": 7.123,
					"Pout": 6.123
				},
				{
					"Sid": 2,
					"Pin": 7.123,
					"Pout": 6.123
				},
				{
					"Sid": 3,
					"Pin": 7.123,
					"Pout": 6.123
				}
			]
		}
	}
}
```

Yerel yıkama işlemi sistem üzerinde donanım olarak kodlanmış tüm filtreler için yapılmaktadır. ilk çıkıştan itibaren kaç kademe ayarlanmış ise sıra ile yıkama yapılacaktır.

**P04** veri paketine (gönderilen) cevap olarak dönecek cevap paketi olan **P94** aşağıda tanımlanmıştır.

***

### P511AA-P05 Veri Paketi

P511 filtre otomasyon sistemi uzaktan filtre yıkamasına olanak veren bir altyapıya sahiptir. Bu işlemi yapabilmesi için sistem herhangi bir işlem yapmadığı (rutin çalışma) koşullarında GSM haberleşmesini di


Sulama sistemi normal çalışma döngüsü içerisinde (herhangi bir filtre kirlenmesi olmadan, herhangi bir temizleme işlemi oluşmadan) P511AA cihazı işlemcisi GSM veri trafiğini devamlı kontrol etmektedir. Bu kontrol sırasında sunucu tarafından bir filtre yıkama isteği gelmesi durumunda (istek paketi aşağıda verilmiştir) sistem uzaktan manuel yıkama işlemini gerçekleştirecektir. Yıkama işlemi sunucu tarafından filtre kademeleri özel olarak seçilebilir olacaktır. Öğrneğin 5 kademeli bir filtre sisteminde 3. filtreyi yıka gibi bir istem yapılabilecektir (bu istem kullanıcıya V1 de açılmayacaktır).

Uzaktan yıkama işlemi başlatılırken tüm filtreler yıkanabileceği gibi sadece belirlenen filtreler de yıkanabilecektir. Ayrıca yönetici tarafından belirlenen süre (yıkama süresi) özel yıkama yapılabilecektir.

Sistem GSM iot yapısı gereği sabit IP sistemdir. Bu sabit IP P01 veri paketi geldiği an tesbit edilip sunucu tarafından yapılacak işlemler bu IP üzerinden yapılacaktır.

	P05 veri paketi P85 istemi üzerine gönderilecektir.

#### P05 - Örnek Veri Paketi (Gönderen : P511AA)

```json
{
	"Device": {
		"ID": "0001767661"
	},
	"Power": {
		"Charger": {
			"Status": 5
		},
		"Battery": {
			"IV": 3.89,
			"T": 25.43,
			"AC": -51.72,
			"SOC": 17.97,
			"IB": 718,
			"CYC": 32
		}
	},
	"IoT": {
		"GSM": {
			"Operator": {
				"RSSI": -81
			}
		}
	},
	"Data": {
		"TimeStamp": "2020-10-23  14:18:28",
		"Event": 112,
		"Irrigation": {
			"Status": 256,
			"Pressure": {
				"Pin": 8.123,
				"Pout": 6.123
			},
			"CleanDetail": [
				{
					"Sid": 4,
					"Pin": 7.123,
					"Pout": 6.123
				},
				{
					"Sid": 7,
					"Pin": 7.123,
					"Pout": 6.123
				}
			]
		}
	}
}
```

Uzaktan manuel yıkama işlemi sistem üzerinde donanım olarak kodlanmış tüm filtrelere uygulanabileceği gibi seçimsel olarak belirli filtrelerin belirli süre ile temizlenebilmesi için yapılabilmektedir.

**P05** veri paketine (gönderilen) cevap olarak dönecek cevap paketi olan **P95** aşağıda tanımlanmıştır.

***

### P511AA-P06 Veri Paketi

Sistem tarafından devamlı ölçümlenmekte olan basınç değerleri belirlenen periodlarla (ön tanım 30sn) ölçümlenmektedir. Sistem regresyon kütüphanesi üzerinden 10 geçmiş veriye ait regresyon hesaplaması yaparak veri trend formulünü hesaplamaktadır. Veri trend formülü (y = ax + b) üzerinden trend eğimi anlık olarak hesaplanmaktadır. Bu eğim her yeni ölçüm ile beraber tekrar hesaplanmaktadır.

Hesaplanan basıç regresyon trendi anlık olarak kontrol edilerek %10 (düşürülebilir) belirsizlik dahilinde analiz edilerek sistem basıncının stabil durumdan düşüş trendine girip girmediği (eğimin -%10 un altında olması) kontrol edilmektedir. Sistem basınç trendinin düşme aşamasına geçtiği tesbit edildiği an P06 veri paketi gönderilecektir. 

P06 veri paketi gönderimi durumunda sulama sistemi hat basıncının düşmeye başladığı anlaşılmaktadır.

#### P06 - Örnek Veri Paketi (Gönderen : P511AA)

```json
{
	"Device": {
		"ID": "0001767661",
	},
	"Power": {
		"Charger": {
			"Status": 5
		},
		"Battery": {
			"IV": 3.89,
			"T": 25.43,
			"AC": -51.72,
			"SOC": 17.97,
			"IB": 718,
			"CYC": 32
		}
	},
	"IoT": {
		"GSM": {
			"Operator": {
				"RSSI": -81
			}
		}
	},
	"Data": {
		"TimeStamp": "2020-10-23  14:18:28",
		"Event": 141
	}
}
```

	Değişken detayları aşağıda tanımlanmıştır.

**P06** veri paketine (gönderilen) cevap olarak dönecek cevap paketi olan **P96** aşağıda tanımlanmıştır.

***

### P511AA-P07 Veri Paketi

	Üzerine çalışılacak ve başka bir algoritma çıkartılmaya çalışışacaktır.

Hat basıncının belirlenen seviyenin altına düşmesi durumunda (planlanan 0.2 Bar basınçtır fakat hat beslemesi yukarı doğru olan durumlarda pompa kapatıldığı an geri gelen su çıkış basıncının düşmesini engelleyebilecektir.) sistemin sulama bitişi bilgisini sunuculara göndermesi için oluşturulmuş veri paketidir. 

**P06** veri paketi gönderimi (koşulların oluşması) durumunda basınç düşüş trendi tamamlandığı an gönderilecek veri paketidir.

Bu paketin gönderilmesi durumunda sulama işleminin tamamlandığı ve sistemin **IDLE** konumuna geçtiği tesbit edilecektir.

#### P07 - Örnek Veri Paketi (Gönderen : P511AA)

```json
{
	"Device": {
		"ID": "0001767661",
	},
	"Power": {
		"Charger": {
			"Status": 5
		},
		"Battery": {
			"IV": 3.89,
			"T": 25.43,
			"AC": -51.72,
			"SOC": 17.97,
			"IB": 718,
			"CYC": 32
		}
	},
	"IoT": {
		"GSM": {
			"Operator": {
				"RSSI": -81
			}
		}
	},
	"Data": {
		"TimeStamp": "2020-10-23  14:18:28",
		"Event": 142
	}
}
```

	Değişken detayları aşağıda tanımlanmıştır.

**P07** veri paketine (gönderilen) cevap olarak dönecek cevap paketi olan **P97** aşağıda tanımlanmıştır.

***

## Cevap Veri Paketleri Yapısı

### P511AA-P91 Veri Paketi

Pompa çalışması tesbit veri paketi olan **P01**  verisine cevap olarak dönmektedir.

#### P91 - Örnek Veri Paketi (Gönderen : Sunucu)

```json
{
	"Event": 500
}
```

	Değişken detayları aşağıda tanımlanmıştır.

### P511AA-P92 / P93 / P94 / P95 / P96 Veri Paketi

Veri gönderim işlemleri (P02, P03, P04, P05 ve P06) sonrasında sunucu tarafından gönderilen cevap paketidir. Bu veri paketi içerisinde filtre ayar değerleri dönmektedir. Bu ayar değerleri şu şekildedir. 

| Değişken Adı      | Açıklama                                  |
|-------------------|-------------------------------------------|
| OnTime            | n numaralı selenoide ait açım süresi.     |
| OffTime           | n numaralı selenoide ait kapatma süresi.  |
| TimedClean        | Zamanlı yıkama süresi.                    |
| DeltaPressure     | Otomatik yıkama basınç farkı. (Dp)        |
| PumpLimit         | Sulama tesbiti minimum basınç değeri (P0) |
| PressureTolerance | Basınç stabilite hata oranı.              |

	Değişken detayları aşağıda tanımlanmıştır.

#### P92 / P93 / P94 / P95 / P96  - Örnek Veri Paketi (Gönderen : Sunucu)

```json
{
	"Event": 560,
	"Setting": {
		"PressureTolerance": 10,
		"PumpLimit": 0.20,
		"DeltaPressure": 0.30,
		"TimedClean": 30,
		"OnTime": [50,50,50],
		"OffTime": [20,20,20]
	},
}
```

### P511AA-P97 Veri Paketi

Pompa durdurulması tesbit veri paketi olan **P07**  verisine cevap olarak dönmektedir.

#### P97 - Örnek Veri Paketi (Gönderen : Sunucu)

```json
{
	"Event": 500
}
```

	Değişken detayları aşağıda tanımlanmıştır.

***

## İstem Veri Paketleri Yapısı

### P511AA-P83 Veri Paketi

P511AA sisteminden veri güncellemesi istemek amacı ile gönderilen veri paketidir. Bu veri paketleri P511 tarafından devamlı dinlenmekte olan GSM üzerinden (sabit IP) ile alınacaktır.

#### P83 - Örnek Veri Paketi (Gönderen : Sunucu)

```json
{
	"Request": {
		"Event": 260
	},
}
```

### P511AA-P85 Veri Paketi

P511AA sisteminin uzaktan filtre yıkama istemi amacı ile gönderilen veri paketidir. Bu veri paketleri P511 tarafından devamlı dinlenmekte olan GSM üzerinden (sabit IP) ile alınacaktır.

Sunucu tarafından tüm filtrelerin temizlenmesi için komut gönderilebileceği gibi sadece belirli filtrelerin temizlene

#### P85 - Örnek Veri Paketi (Gönderen : Sunucu)

```json
{
	"Request": {
		"Event": 260,
		"Clean": {
			"Filter": "F0000000001001000",
			"CleanTime": [0,0,0,0,0,0,0,0,0,10,0,0,10,0,0,0]
		}
	},
}
```

## Gönderilen Veri Paketi Değişken Yapısı

IoT veri paketleri genel yapı itibari ile 4 ana segmentten oluşmaktadır. Bu segmentler şu şekildedir.

![Data Structure](https://i.imgyukle.com/2020/12/03/YoJ5nj.png)

***

### 1. Device

Bu segment içerisinde cihaza ait üretim bilgilerinin olduğu datalar yer almaktadır.

```json
"Device": {
	"ID": "0001767661",
	"Hardware": "01.00.00",
	"Firmware": "01.06.00"
},
```

| Değişken    | Örnek Veri       | Değişken Tipi             | P01 | P02 | P03 | P04 | P05 | P06 | P07 |
|-------------|------------------|---------------------------|-----|-----|-----|-----|-----|-----|-----|
| ID          | "FFFFFFFFFFFFFF" | 48+8 bit HEX (String)     |  +  |  +  |  +  |  +  |  +  |  +  |  +  |
| Hardware    | "01.00.00"       | XX.XX.XX yapısında String |  +  |  -  |  -  |  -  |  -  |  -  |  -  |
| Firmware    | "01.00.00"       | XX.XX.XX yapısında String |  +  |  -  |  -  |  -  |  -  |  -  |  -  |
| FilterCount | 3                | Integer                   |  +  |  -  |  -  |  -  |  -  |  -  |  -  | 

#### 1.A. : “ID" Numarası

Cihaza ait tekil id numarasıdır. Bu numara ile tüm veritabanı kayıt işlemleri indekslenecektir. Seri üretim cihazlarda (prototip ürünler için ek açıklama aşağıda belirtilmiştir) bu tekil veriyi sağlaması hemde her cihazın ayrı ayrı kodlanması iş yükünü getirmemek adına sistem içerisinde DS28C serial id çipi kullanılacaktır. Bu çip üzerinde fabrika çıkışı olarak kodlanmış 48 bit bir id bulunmaktadır. Elektronik sistemlerde genellikle veriler çip içerisinde bit olarak saklanmaktadır. Bu veriler okunduğu zaman HEX formatında okunmaktadır onluk sistemede çevrilebilecek olan bu id değişken taşması yaşamamak adına string olarak işleme alınmaktadır. DS28C çipi üzerinden onunan bu 48 bit id ye ek olarak 8 bit CRC verisi okunmaktadır. Polynomial “X8 + X5 + X4 + 1" doğrulama algoritması yardımı ile id doğrulaması yapılabilmektedir. Bu nedenle veri gönderimi yaparken 48+8 bit veri paketi HEX String formatında gönderilecektir.

	Veri paketi toplam 14 byte uzunluğunda (hep aynı uzunlukta) HEX

Prototip Cihazlar : üzerinde DS28C çipi bulundurmadığı için sistem üzerinde bulunana tek unique rakam olan GE910 GSM Modeme ait seri numarası paket içerisinde gönderilmektedir.

#### 1.B. : “Hardware" Versiyonu

Cihazın donanım tarafına ait tanımlayıcı versiyon bildirimidir. Majör ve minör versiyon yanı sıra (donanım versiyonu içerdiği modüllerde yer alan değişikliklere göre şekillenmektedir) üretim parti numarasını içermektedir. İlk 2 basamak **majör donanım versiyonu** sonraki 2 basamak ise **minör donanım versiyonu** bilgisini vermektedir. Son 2 basamak ise üretim parti numarasını içermektedir. Tüm bu versiyon yapısı GIT reposu üzerindeki release kodlarına aittir ve detayları repo üzerinde açıklanmıştır. XX.XX.XX yapısı şeklinde 8 byte string olarak gönderilmektedir (hep aynı uzunlukta).

	Versiyon kodlama yapısı semantik kodlama sistemi üzerine kurgulanmıştır.

#### 1.C. : “Firmware" Versiyonu

Cihazın firmware tarafına ait tanımlayıcı versiyon bildirimidir. Majör, minör ve hata düzeltme durumlarını içermektedir. İlk 2 basamak **majör yazılım versiyonu** sonraki 2 basamak ise **minör yazılım versiyonu** bilgisini vermektedir. Son 2 basamak ise hata düzeltme kod versiyonu bilgisini içermektedir. Sistem yapı gereği uzaktan güncelleme yapılabilir bir sistem olması öngörüldüğü için firmware kodlaması önem teşkil etmektedir. Donanım versiyonuna göre hangi cihazların firmware güncellemesi yapılabileceği gibi bilgiler sistem üzerinde tutulacaktır. Cihazın istemesi durumunda firmware download edebilir olacaktır (sadece cihaz tarafından firmware download yapılabilecektir).

#### 1.D. : “FilterCount" Değeri

Filtre cihazları üzerinde cihaz özelliğine bağlı olarak birden fazla filtre olabilmektedir. P511 sistemi max 16 kademe olacak şekilde tasarlanmıştır. Bu kademe sayısı P511 üzerinde yer alan seçim anahtarları ile seçilmektedir. Bu veri P01 veri paketi ile sulamaya başlandığı zaman sunuculara gönderilmektedir. 

***

### 2. Power

Geliştirilen donanımların tamamı batarya destekli sistemler olarak tasarlanmaktadır. Herhangi bir güç kaynağına bağlı olarak çalışsa bile güç kesilmesi durumunda sunuculara veri gönderebilmek için yeterli enerjiye sahip olmaları gerekmektedir. Bu nedenle tüm ürünler üzerinde Li-Ion batarya (ürün cinsine göre adedi ve gücü değişmektedir bu bilgi donanım versiyonu içerisinde yer alacaktır) kullanılmaktadır.

Li-Ion bataryalar yapı gereği 3V8 nominal voltaj, 4V2 max voltaj ve 3V0 min voltaj olarak karakterize edilmektedir. Bu değerler teorik değerler olup ortam sıcaklığına göre değişmektedir. Düşük sıcaklıklar bir sorun değil bir avantajdır ve pil yaşlanmasını azaltır. Bununla beraber bataryaların 3V0 değerine düşmesi istenmeyen bir durumdur genellikle 3V2-3V4 aralığına düşmüş bataryalar boş olarak değerlendirilir.

Bu kapsamda donanımlar üzerinde batarya şarj ve batarya ölçümleme sistemleri bulunmaktadır. Bu sistemler üzerinden alınan veriler hem anlık hem de ileri vade sürdürülebilirlik analizleri için kaydedilmelidir.

Bu segment içerisinde cihaza ait güç parametreleri yer alamaktadır. Batarya durumu şarj bilgileri gibi parametreler bu alan içerisinde yer almaktadır. P101CA meteoroloji istasyonu güç kaynağı olarak sadece batarya kullanmaktadır ve bu batarya güneş paneli üzerinden şarj edilmektedir. Kaynak tek olduğu için (220v, adaptör, usb vb olmadığı için) güç segmenti içerisinde gereksiz kısımlar gönderilmemektedir.

```json
"Power": {
	"Firmware": "01.06.01",
	"Charger": {
		"Status": 5
	},
	"Battery": {
		"IV": 3.89,
		"T": 25.43,
		"AC": -51.72,
		"SOC": 17.97,
		"IB": 718,
		"CYC": 32
	}
},
```

| Değişken | Örnek Veri       | Değişken Tipi             | P01 | P02 | P03 | P04 | P05 | P06 | P07 |
|----------|------------------|---------------------------|-----|-----|-----|-----|-----|-----|-----|
| Firmware | "01.00.00"       | XX.XX.XX yapısında String |  +  |  -  |  -  |  -  |  -  |  -  |  -  |
| Status   | 5                | Intiger                   |  +  |  +  |  +  |  +  |  +  |  +  |  +  |
| IV       | 3.89             | Float                     |  +  |  +  |  +  |  +  |  +  |  +  |  +  |
| T        | 25.43            | Float                     |  +  |  +  |  +  |  +  |  +  |  +  |  +  |
| AC       | -51.72           | Float                     |  +  |  +  |  +  |  +  |  +  |  +  |  +  |
| SOC      | 17.97            | Float                     |  +  |  +  |  +  |  +  |  +  |  +  |  +  |
| IB       | 718              | Integer                   |  +  |  +  |  +  |  +  |  +  |  +  |  +  |
| CYC      | 32               | Integer                   |  +  |  +  |  +  |  +  |  +  |  +  |  +  |

#### 2.A. “Firmware"

```json
"Firmware": "01.06.01",
```

|                 | Açıklama                                             |
|-----------------|------------------------------------------------------|
| Değişken Adı    | Firmware                                             |
| Değişken Tanımı | Power Library **Firmware** (Güç kütüphanesi versiyonu) |
| Değişken Tipi   | String (8 Byte)                                      |
| Değişlen Birimi | -                                                    |
| Örnek Veri      | 01.06.11                                             |

Sistem güç mimarisine ait kütüphane tanımlayıcı versiyon bilgisidir. Majör, minör ve hata düzeltme durumlarını içermektedir. İlk 2 basamak **majör yazılım versiyonu** sonraki 2 basamak ise **minör yazılım versiyonu** bilgisini vermektedir. Son 2 basamak ise hata düzeltme kod versiyonu bilgisini içermektedir.

#### 2.B. “Charger"

Li-Ion bataryalar sabit akım ve sabit voltaj adı verilen iki kademeli şarj sistemi ile şarj edilebilmektedir. Bu kademeli şarj sistemi ve max/min şarj voltajlarını kontrol edebilmek adına bir şarj sistematiği kurgulanması gerekmektedir. Sistemlerimiz içerisinde MCP73871 şarj entegresi kullanılmakta ve şarj işleminin (besleme kaynağı tipi önem teşkil etmemektedir) kontrolü sağlanmaktadır.

#### 2.B.1. “Status"

```json
“Status": 5
```

|                 | Açıklama                                        |
|-----------------|-------------------------------------------------|
| Değişken Adı    | Status                                          |
| Değişken Tanımı | Charger **Status** (Şarj durumu)                |
| Değişken Tipi   | int                                             |
| Değişlen Birimi | -                                               |
| Örnek Veri      | 2 (1-6)                                         |

MCP73871 şarj entegresi şarj durumlarını belirten 3 adet çıkışa sahiptir ve bu çıkışlar işlemci tarafından okunarak veri paketi ile birlikte sunuculara kaydedilmektedir. Bu sayede şarj durumu ile güç kaynaklı arıza durumları tesbit edilebilir hale getirilmiştir. Bu 3 çıkışın neleri ifade ettiği aşağıdaki tabloda belirtilmiştir.

| Status ID | Durum           | Stat1 | Stat2 | PG    | Açıklama                                  |
|-----------|-----------------|-------|-------|-------|-------------------------------------------|
| 1         | Shutdown        | true  | true  | true  | Şarj icin gerekli olan güç beslemesi yok  |
| 2         | Charging        | false | true  | false | Şarj oluyor                               |
| 3         | Charge Complete | true  | false | false | Şarj tamamlandı                           |
| 4         | Low Battery     | false | true  | true  | Düşük batarya voltajı                     |
| 5         | No Battery      | true  | true  | false | Sisteme bağlı bir batarya yok             |
| 6         | --              | -     | -     | -     | Tanımlanamayan durum                      |

Şarj sistematiğine ait durumları (yukarıdaki tabloda tanımlanan) belirtir veridir. Bu durum değerleri sayesinde solar panelden (veya diğer kaynaktan) şarj edilen P101CA için arıza tesbiti yapılabilecektir.

Bu veri alanı gerekli durumlarda UI üzerinde direkt olarak gösterilebilecektir (örneğin şarj oluyor ikonu).

#### 2.C. : “Battery"

Sistem içerisinde kullanılmakta olan bataryaların anlık olarak takip edilmesi hem güvenlik hemde sürdürülebilirlik açısından önem teşkil etmektedir. Bu nedenle sistem içerisine MAX17055 batarya ölçüm sistematiği kurgulanmıştır. Bu sayede birçok batarya parametresini ölçümleyebilmekteyiz. Bu veri paketi içersinde analiz için gerekli önemli parametreler gönderilmektedir.

#### 2.C.1. : “IV"

```json
"IV": 3.89,
```

|                 | Açıklama                                        |
|-----------------|-------------------------------------------------|
| Değişken Adı    | IV                                              |
| Değişken Tanımı | **I**nstant **V**oltage (Anlık batarya voltajı) |
| Değişken Tipi   | Float                                           |
| Değişlen Birimi | Volt                                            |
| Örnek Veri      | 3.89                                            |

Sistem kurulu bataryasına ait anlık voltaj bilgilerini vermektedir. Sonraki versiyonlarda voltaj değeri üzerinden güç analizleri ve batarya sağlığı konusunda analizler yapılabilecektir. Kullanılan batarya voltaj alt ve üst limitleri kayıt sırasında kontrol edilebilir (?).

#### 2.C.2. : “T"

```json
"T": 25.43,
```

|                 | Açıklama                                        |
|-----------------|-------------------------------------------------|
| Değişken Adı    | T                                               |
| Değişken Tanımı | **T**emperature (Anlık Çip Sıcaklığı)           |
| Değişken Tipi   | Float                                           |
| Değişlen Birimi | Santigrat                                       |
| Örnek Veri      | 25.43                                           |

Sistem güç katmanı üzerinde bulunan MAX17055 batarya ölçümleme çipi üzerinden ölçülen kart sıcaklığıdır. Sonraki versiyonlarda sıcaklık değeri üzerinden güç analizleri ve batarya sağlığı konusunda analizler yapılabilecektir.

#### 2.C.3. : “AC"

```json
"AC": -51.72,
```

|                 | Açıklama                                        |
|-----------------|-------------------------------------------------|
| Değişken Adı    | AC                                              |
| Değişken Tanımı | **A**verage **C**urrent (Ortalama Akım)         |
| Değişken Tipi   | Float                                           |
| Değişlen Birimi | mA                                              |
| Örnek Veri      | -51.72                                          |

Sistem güç katmanı üzerinde bulunan MAX17055 batarya ölçümleme çipi üzerinden ölçülen ortalama akım bilgisidir. Batarya ölçüm çipinin kullanılmasında ki birincil öncelik bu veridir (IV ile birlikte). Çip bataryaya bağlı kaldığı süre boyunca ölçümleme yapar ve bu verilerin ortalamalarını iç registerlarında tutar. Bu verinin negatif değer olması tüketim olduğunu (bataryadan güç çekimi), pozitif olması ise şarj olduğunu belirtmektedir (bataryaya doğru güç). Sonraki versiyonlarda akım değeri üzerinden güç analizleri ve batarya sağlığı konusunda analizler yapılabilecektir.

#### 2.C.4. : “SOC"

```json
"SOC": 17.97,
```

|                 | Açıklama                                        |
|-----------------|-------------------------------------------------|
| Değişken Adı    | SOC                                             |
| Değişken Tanımı | **S**tate **o**f **C**harge (Kapasite yüzdesi)  |
| Değişken Tipi   | Float                                           |
| Değişlen Birimi | %                                               |
| Örnek Veri      | 17.97                                           |

Sistem güç katmanı üzerinde bulunan MAX17055 batarya ölçümleme çipi üzerinden ölçülen batarya doluluk oranı bilgisidir. Batarya paketinin firmware üzerinde ayarlanmış kapasitesi ile anlık olarak ölçümlenen batarya kapasite oranı olarak hesaplanmaktadı. Bu hesap için batarya karakteristik eğrileri kullanılmakta ve lineer olmayan bir hesap ölçüm çipi tarafından anlık olarak yapılmaktadır.

Bu değer UI tasarımlar içerisinde batarya durum bilgisi olarak direkt paylaşılabilir yapıdadır.

#### 2.C.5. : “IB"

```json
"IB": 718,
```

|                 | Açıklama                                        |
|-----------------|-------------------------------------------------|
| Değişken Adı    | IB                                              |
| Değişken Tanımı | **I**nstant **B**attery (Anlık Kapasite)        |
| Değişken Tipi   | int                                             |
| Değişlen Birimi | mAh                                             |
| Örnek Veri      | 718                                             |

Sistem güç katmanı üzerinde bulunan MAX17055 batarya ölçümleme çipi üzerinden ölçülen batarya anlık kapasite bilgisidir. Bu kapasite bilgisi mAh birimi üzerinden batarya döngüsüne göre anlık olarak hesaplanmaktadır. Herhangi bir harici kaynaktan set edilmemektedir. SOC değeri üzerinden bu veri değeri çarpılarak toplam kapasite bilgisine ulaşılabilmektedir bu nedenle FB değeri gönderilmemiştir.

#### 2.C.6. : “CYC"

```json
"CYC": 32
```

|                 | Açıklama                                        |
|-----------------|-------------------------------------------------|
| Değişken Adı    | CYC                                             |
| Değişken Tanımı | **Cyc**le (Batarya Şarj Deşarj Sayısı)          |
| Değişken Tipi   | int                                             |
| Değişlen Birimi | -                                               |
| Örnek Veri      | 32                                              |

Sistem güç katmanı üzerinde bulunan MAX17055 batarya ölçümleme çipi üzerinden ölçülen batarya şarj-deşarj döngü bilgisidir. Tam boşalma ve tam dolma değeri 1 cycle olarak değerlendirilmektedir. Fakat bilinmelidir ki Li-Ion bataryalarda şarj deşarj hafızası yoktur (yani tam boşalmadan şarj edilmesinde bir sorun yoktur) bu nedenle %10 boşalmış bir bataryanın doldurulması tam döngü sayılmazken 10 defa %10 şarj-deşarj bir döngü sayılmaktadır. Cyc değeri zorunlu bir değer olmamasına karşın uzun vade analizlerde cihaz sağlığı belirlenebilmesi için bir parametre olarak düşünülmüştür.

***

### 3- IoT

Geliştirilen cihazların tamamı etkileşimli IoT cihazlar olarak tanımlanmaktadır. Bu nedenle veri paketi içerisinde iletişim alt parametrelerinin olduğu bir alan ihtiyacı doğmuştur. Cihaz bazında ek seçenekleri olmakla birlikte P511AA cihazı GSM tabanlı bir IoT iletişim altyapısına sahiptir.

IoT iletişim bloğuna ait cihaz tarafından gönderilen veri paketi aşağıdaki yapıdadır.

```json
"IoT": {
	"GSM": {
		"Firmware": "01.06.01",
		"Module": {
			"IMEI": "353613080341053"
		},
		"SIM": {
			"SIM_Type": 1,
			"Iccid": "8990011901130266075"
		},
		"Operator": {
			"Code": 28601,
			"RSSI": -81,
			"Conn_Time": 22
		}
	}
},
```
| Değişken  | Örnek Veri            | Değişken Tipi             | P01 | P02 | P03 | P04 | P05 | P06 | P07 |
|-----------|-----------------------|---------------------------|-----|-----|-----|-----|-----|-----|-----|
| Firmware  | "01.00.00"            | XX.XX.XX yapısında String |  +  |  -  |  -  |  -  |  -  |  -  |  -  |
| IMEI      | "353613080341053"     | String                    |  +  |  -  |  -  |  -  |  -  |  -  |  -  |
| SIM_Type  | 1                     | Integer                   |  +  |  -  |  -  |  -  |  -  |  -  |  -  |
| ICCID     | "8990011901130266075" | String                    |  +  |  -  |  -  |  -  |  -  |  -  |  -  |
| Code      | 28601                 | Integer                   |  +  |  -  |  -  |  -  |  -  |  -  |  -  |
| RSSI      | 32                    | Integer                   |  +  |  +  |  +  |  +  |  +  |  +  |  +  |
| Conn_Time | 22                    | Integer                   |  +  |  -  |  -  |  -  |  -  |  -  |  -  |

#### 3.A. : “GSM"

P511AA cihazı Telit firmasının üretmekte olduğu 2G altyapısına sahip haberleşme imkanı sunan GE910QUAD modemini barındırmaktadır. 2G şebeke kullanan en stabil modem olması nedeniyle bu model seçilmiştir ve 3G,LTE,5G bantlarını destekleyen xE910 ailesinin bir ürünüdür. Footprint değişikliği olmadan sadece modül değiştirerek bant seçimi yapılabilmektedir.

#### 3.A.1. : “Firmware"

```json
"Firmware": "01.06.01",
```

|                 | Açıklama                                             |
|-----------------|------------------------------------------------------|
| Değişken Adı    | Firmware                                             |
| Değişken Tanımı | GSM Library **Firmware** (GE910 kütüphane versiyonu) |
| Değişken Tipi   | String (8 Byte)                                      |
| Değişlen Birimi | -                                                    |
| Örnek Veri      | 01.06.11                                             |

GSM IoT iletişime ait kütüphane tanımlayıcı versiyon bilgisidir. Majör, minör ve hata düzeltme durumlarını içermektedir. İlk 2 basamak **majör yazılım versiyonu** sonraki 2 basamak ise **minör yazılım versiyonu** bilgisini vermektedir. Son 2 basamak ise hata düzeltme kod versiyonu bilgisini içermektedir.

#### 3.A.2. : “Module"

Bu veri alanı GSM modeme ait fiziksel özellik değerlerini içermektedir.

#### 3.A.2.1. : “IMEI"

```json
"IMEI": "353613080341053"
```

|                 | Açıklama                                             |
|-----------------|------------------------------------------------------|
| Değişken Adı    | IMEI                                                 |
| Değişken Tanımı | GSM Modem **IMEI** Number (IMEI)                     |
| Değişken Tipi   | String (15 Byte)                                     |
| Değişlen Birimi | -                                                    |
| Örnek Veri      | 353613080341053                                      |

GSM Modemleri fiziksel olarak kayıt altına alabilmek ve devlet regülasyonuları için anahtar oluşturması için her GSM modemde olması gereken tekil 15 byte bir veridir. Bu id sayesinde modem satınalma parti vs gibi bilgiler takip edilebilmektedir.

#### 3.A.3. : “SIM"

GSM uygulamalarında şebekeye bağlanabilmek için bir SIM gerekmektedir. Bu SIM e ait hep sürdürülebilirlik hemde cihaz kimlik takibi yapabilmek amacı ile parametrelerin her veri paketinde gönderilmesi gerekmektedir. Bu veri alanı içerisinde SIM e ait sabitlerin değerleri içermektedir.

#### 3.A.3.1. : “SIM_Type"

```json
"SIM_Type": 1,
```

|                 | Açıklama                                             |
|-----------------|------------------------------------------------------|
| Değişken Adı    | SIM_Type                                             |
| Değişken Tanımı | SIM type                                             |
| Değişken Tipi   | int                                                  |
| Değişlen Birimi | -                                                    |
| Örnek Veri      | 1 (1-3)                                              |

Donanım katmanı üzerinde SIM farklı şekillerde sisteme eklenebilmektedir. Bu tipler aşağıdaki tabloda tanımlanmıştır.

| SIM_Type | Açıklama                                                      |
|----------|---------------------------------------------------------------|
| 1        | Sim Tray e takılan fiziksel SIM kart (boyut önemi olmaksızın) |
| 2        | MFF2 SIM chip                                                 |
| 3        | Modüle gömülü embedded SIM                                    |

#### 3.A.3.2. : “ICCID"

```json
"Iccid": "8990011901130266075"
```

|                 | Açıklama                                             |
|-----------------|------------------------------------------------------|
| Değişken Adı    | ICCID                                                |
| Değişken Tanımı | **I**ntegrated **C**ircuit **C**ard **I**dentifier   |
| Değişken Tipi   | String (19/20 byte)                                  |
| Değişlen Birimi | -                                                    |
| Örnek Veri      | 8990011901130266075                                  |

ICCID (Integrated Circuit Card Identifier) olarak bilinen kod numarası GSM şebekelerde telefon numarasının ve mobil operatör faturalandırma alt yapısı için kullanılan dünya genelinde tekil bir koddur. Sistemlerimiz içerisinde mobil operatör tarafında işlemlerin kolayca kontrol edilebilmesi amacı ile bu kod sistemlerimizde saklanacaktır.

#### 3.A.4. : “Operator"

GSM IoT sistemler içerisinde bir diğer önemli kısımda bağlantı ve operatör değişkenleridir. Bu alan altında GSM modem ile SIM üzerinde belirtilen operatöre bağlantı yapıldıktan sonra elde edişen veriler yer almaktadır.

#### 3.A.4.1. : “Code"

```json
"Code": 28601,
```

|                 | Açıklama                                             |
|-----------------|------------------------------------------------------|
| Değişken Adı    | Code                                                 |
| Değişken Tanımı | Operator **Code** (Operatör kodu)                    |
| Değişken Tipi   | int                                                  |
| Değişlen Birimi | -                                                    |
| Örnek Veri      | 28601                                                |

GSM in hangi operatöre bağlandığı bilgisidir. Her operatör için dünya genelinde hazırlanmış bir kod [listesi](https://www.mcc-mnc.com) mevcuttur. Türkiye için operatör listesi aşağıdaki gibidir.

| Operator Code | Operator Adı |
|---------------|--------------|
| 28601         | Turkcell     |
| 28602         | Vodafone     |
| 28603         | Turk Telekom |
| 28604         | Turk Telekom |

#### 3.A.4.2. : “RSSI"

```json
“RSSI": 30,
```

|                 | Açıklama                                             |
|-----------------|------------------------------------------------------|
| Değişken Adı    | RSSI                                                 |
| Değişken Tanımı | **R**eceived **S**ignal **S**trength **I**ndicator (Sinyal gücü) |
| Değişken Tipi   | int                                                  |
| Değişlen Birimi | -                                                    |
| Örnek Veri      | 30                                                   |

Sistemi şebekeye bağlantı sinyal gücü hakkında bilgi vermektedir. dBm dönüşümü aşağıdaki şekilde yapılmaktadır.

| RSSI  | dBm           | Açıklama                |
|-------|---------------|-------------------------|
| 0     | <= -113       |                         |
| 1     | -111          |                         |
| 2..30 | -109 <-> -53  | Her 1 basamak için 2dBm |
| 31    | >= -51        |                         |
| 99    |               | Tesbit edilemedi        |

dBm için belirlenen sinyal çekim seviyesi 5 üzerinden aşağıdaki gibi hesaplanmaktadır (UI için çekim çubukları)

| dBm                  | Seviye     | Açıklama                                |
|----------------------|------------|-----------------------------------------|
| >= -70 dBm           | Mükemmel   | Güçlü sinyal ve maksimum veri hızı      |
| -70 dBm <-> -85 dBm  | Güzel      | Güçlü sinyal güçlü veri hızı            |
| -86 dBm <-> -100 dBm | İyi        | Zayıf sinyal fakat kullanışlı veri hızı |
| < -100 dBm           | Zayıf      | Zayıf sinyal problemli veri hızı        |
| -110 dBm             | Kötü       | Kötü bağlantı kopma yaşanabilir         |

#### 3.A.4.3. : “Conn_Time"

```json
"Conn_Time": 10
```

|                 | Açıklama                                             |
|-----------------|------------------------------------------------------|
| Değişken Adı    | Conn_Time                                            |
| Değişken Tanımı | **Conn**ection **Time** Length (Hat alabilme süresi) |
| Değişken Tipi   | int                                                  |
| Değişlen Birimi | Sn                                                   |
| Örnek Veri      | 10                                                   |

GSM IoT sistemler öncelikle şebeke bağlantısı kurar ve daha sonra 2G alt yapısı üzerine kendisini kaydettirir. Bu iki işlem için gerekli olan süre Bağlanabilme süresi olarak tanımlanır ve operatörün bölgedeki gücünün ölçümünde kullanılır. Bu nedenle büyük ölçekte şebeke haritası çıkartabilmek için bu veri sunuculara gönderilmektedir.

***

### 4- Data

P511AA sisteminin işlem verilerinin tamamını içerisinde barından veri paketi bölümüdür. Bu paket içerisinde işlem zamanı yanı sıra işlem verileri yer almaktadır. Bu işlem verileri her paket için farklı bir yapıda oluşturulmaktadır. Tüm iletişim paketi içerisindeki veriler sisteme ait değerler barındırırken bu alan ölçüm yapılacak işleme ait veriler barındırmaktadır.

Data paket alanı içerisinde yer alan veriler yukarıda tanımlanan paket yapıları ile gönderilmektedir. Aşağıda tüm bu paket içi değişkenler detalı olarak tanımlanmıştır.

#### 4.A. : “TimeStamp"

```json
"TimeStamp": "2020-10-23  14:18:28",
```

|                 | Açıklama                                             |
|-----------------|------------------------------------------------------|
| Değişken Adı    | TimeStamp                                            |
| Değişken Tanımı | Veri ölçümleme zamanına ait zaman etiketi            |
| Değişken Tipi   | Date/Time                                            |
| Değişlen Birimi | -                                                    |
| Örnek Veri      | 2020-10-23  14:18:28                                 |

Veri paketinin oluşum zamana ait zaman etiketidir.

#### 4.B. : “Event"

```json
"Event": 111,
```

|                 | Açıklama                                             |
|-----------------|------------------------------------------------------|
| Değişken Adı    | Event                                                |
| Değişken Tanımı | Sistemin veriyi gönderme sebebi                      |
| Değişken Tipi   | int                                                  |
| Değişlen Birimi | -                                                    |
| Örnek Veri      | 191                                                  |

Sistemin ölçümlemeyi hangi sebeple yapıp gönderdiğine ait durum değişkenidir. Aşağıdaki tabloda olası veri gönderim kaynakları tanımlanmıştır. Event veri kodlaması 3 basamaktan oluşan bir sistematik içerisinde kurulmuştur. Bu basamaklar:

**Trigger** : Paketin oluşum sebebini tanımlayan basamaktır.
**Type** : Yapılan işleme ait tanım basamağıdır.
**Source** : Bu işlemin hangi kaynak ile oluşturulduğunu tanımlayan basamaktır.

Bu segmentasyon doğruluk tablosu aşağıda verilmiştir.

| Trigger     | Type       | Source          |
|-------------|------------|-----------------|
| 0-          | 0- OK      | 0- OK           |
| 1- Event    | 1- IDLE    | 1- Pump         |
| 2- Request  | 2- Start   | 2- Irrigation   |
| 3-          | 3- Active  | 3- Auto Clean   |
| 4-          | 4- Stop    | 4- Manuen Clean |
| 5- Response | 5- Clean   | 5- Timed Clean  |
| 6-          | 6- Update  | 6- Remote Clean |
| 7-          | 7-         | 7-              |
| 8-          | 8-         | 8-              |
| 9- Error    | 9-         | 9-              |

Sistem donanım kurgusu gereği cihaz üzerinde oluşan işlemlere göre veri paketi üretmektedir ve bu veri paketleri yukarıda detaylı olarak tanımlanmıştır.

| Event            | Code |
|------------------|------|
| IDLE             | 100  |
| Pump Start       | 121  |
| Irrigation Start | 122  |
| Update (manuel)  | 160  |
| Update (request) | 260  |
| Clean (auto)     | 153  |
| Clean (manuel)   | 154  |
| Clean (remote)   | 256  |
| Clean (timed)    | 155  |

#### 4.C. : “Status"

```json
"Event": 106,
```
Filtrenin çalışma koşullarını tanımlayan değişkendir. Giriş - çıkış basınçları ve diğer filtre parametrelerine göre hazırlanmış bir tablodur.

|                 | Açıklama                                             |
|-----------------|------------------------------------------------------|
| Değişken Adı    | Status                                               |
| Değişken Tanımı | Filtre Durum Kodu                                    |
| Değişken Tipi   | Integer                                              |
| Değişlen Birimi | -                                                    |
| Örnek Veri      | 200                                                  |

**Status** kodları diğer bir değişle **filtre karar tablosu** ve bu koda karşılık gelen temizleme izinleri aşağıdaki tabloda belirtilmiştri. Aşağıda belirtilen kodlara ek olarak sistemin hiçbir işlem yapmaması durumunda **200** durum kodu tanımlanmıştır. 

| Status |            |             |            |            |            |             |            | Auto | Manuel | Timed |
|:------:|------------|-------------|------------|------------|------------|-------------|------------|:----:|:------:|:-----:|
| 100    | Pin => 1,5 | Pout => 0,3 | Pin < 9    | Pin > Pout | DP > X     | Pout => 1,5 |            | +    | +      | +     |
| 101    | Pin > 0,1  | Pout < 0,3  | Pin < 9    | Pin > Pout |            |             |            | -    | -      | -     |
| 102    | Pin > Pout | Pout => 0,3 | Pin < 9    | Pout < 1,5 | DP > X     |             |            | +    | +      | +     |
| 103    | Pin <> 0   | Pout <> 0   | Pin < 9    | Pin > 1,5  | Pin > Pout | Pout => 1,5 | DP <= X    | +    | +      | +     |
| 104    | Pin <> 0   | Pout <> 0   | Pin < 9    | Pin > 1,5  | Pin = Pout | Pout => 1,5 | DP <= X    | -    | +      | -     |
| 105    | Pin < 1,5  | Pout < 1,5  | Pin = Pout | Pout > 0,3 | DP <= X    |             |            | +    | +      | +     |
| 106    | Pin < 1,5  | Pout < 1,5  | Pin > Pout | Pout > 0,3 | DP <= X    |             |            | +    | +      | +     |
| 107    | Pin => 0,1 | Pout => 0,1 | Pout > Pin |            |            |             |            | -    | +      | +     |
| 108    | Pin < 0,1  | Pout => 0,1 | Pout > Pin |            |            |             |            | -    | +      | +     |
| 109    | Pin => 9   | DP =< X     |            |            |            |             |            | -    | +      | -     |
| 110    | Pin => 9   | DP > X      |            |            |            |             |            | +    | +      | +     |

  - Pin : Filter Input Pressure
  - Pout : Filter Output Pressure  
  - DP : Filter Delta Pressure Pressure (DP = Pin - Pout)

#### 4.D. : “Pin"

```json
"Pin": 8.123,
```

Pompadan filtreye giren sulama hattına ait basınç değeridir. Bu basınç değeri P511AA sistemi üzerinde bulunan basınç sensörü ve I2C ADC dönüştürücü sayesinde ölçümlenmektedir. Çoklu ölçüm yapılarak değerin stabil olması sağlanmaktadır.

|                 | Açıklama                                             |
|-----------------|------------------------------------------------------|
| Değişken Adı    | Pin                                                  |
| Değişken Tanımı | Filtre Giriş Basıncı                                 |
| Değişken Tipi   | Float                                                |
| Değişlen Birimi | Bar                                                  |
| Örnek Veri      | 8.123                                                |

#### 4.E. : “Pout"

```json
"Pout": 7.123,
```
Filtreden çıkan sulama hattına ait basınç değeridir. Bu basınç değeri P511AA sistemi üzerinde bulunan basınç sensörü ve I2C ADC dönüştürücü sayesinde ölçümlenmektedir. Çoklu ölçüm yapılarak değerin stabil olması sağlanmaktadır.

|                 | Açıklama                                             |
|-----------------|------------------------------------------------------|
| Değişken Adı    | Pout                                                 |
| Değişken Tanımı | Filtre Çıkış Basıncı                                 |
| Değişken Tipi   | Float                                                |
| Değişlen Birimi | Bar                                                  |
| Örnek Veri      | 8.123                                                |

#### 4.F. : “Interval"

```json
"Interval": 30,
```

Sistemin giriş ve çıkış basınçlarının, hat basıncının sabitleninceye kadar olan aralıklı ölçümlerine ait zaman aralığı verisidir. Sistem belirtilen bu zaman aralığında Pin ve Pout basıncını ölçümleyerek eğim açısı hesabı yapmaktadır. Timestamp zamanında itibaren her ölçüm bu aralıkla yapılmaktadır. 

|                 | Açıklama                                             |
|-----------------|------------------------------------------------------|
| Değişken Adı    | Interval                                             |
| Değişken Tanımı | Filtre Çıkış Basıncı analiz ölçüm aralığı            |
| Değişken Tipi   | Integer                                              |
| Değişlen Birimi | Saniye                                               |
| Örnek Veri      | 30                                                   |

#### 4.G. : “IN"

```json
"IN": [1.12,1.12,1.12,1.12],
```

Sistemin giriş basıncının, hat basıncının sabitleninceye kadar olan aralıklı ölçümlerine ait basınç verisidir. Sistem belirtilen bu zaman aralığında Pin basıncını ölçümleyerek eğim açısı hesabı yapmaktadır. Timestamp zamanında itibaren her ölçüm bu aralıkla yapılmaktadır. 

|                 | Açıklama                                             |
|-----------------|------------------------------------------------------|
| Değişken Adı    | IN                                                   |
| Değişken Tanımı | Hat basıncı sabitlenme öncesi Pin değerleri.         |
| Değişken Tipi   | Float [Dizi]                                         |
| Değişlen Birimi | Bar                                                  |
| Örnek Veri      | 2.123                                                |

#### 4.H. : “OUT"

```json
"OUT": [1.12,1.12,1.12,1.12],
```

Sistemin çıkış basıncının, hat basıncının sabitleninceye kadar olan aralıklı ölçümlerine ait basınç verisidir. Sistem belirtilen bu zaman aralığında Pout basıncını ölçümleyerek eğim açısı hesabı yapmaktadır. Timestamp zamanında itibaren her ölçüm bu aralıkla yapılmaktadır. 

|                 | Açıklama                                             |
|-----------------|------------------------------------------------------|
| Değişken Adı    | OUT                                                  |
| Değişken Tanımı | Hat basıncı sabitlenme öncesi Pout değerleri.        |
| Değişken Tipi   | Float [Dizi]                                         |
| Değişlen Birimi | Bar                                                  |
| Örnek Veri      | 2.123                                                |

#### 4.J. : “Sid"

```json
"Sid": 2,
```

Sistem içerisinde yapılmış olan işlemlerde filtre içerisindeki bir kademeyi (filtre kademesi) belirtmek amacı ile kullanılan veridir. Bu veri P01 veri paketi içerisinde gönderilen **FilterCount** değerinden büyük olamaz.

|                 | Açıklama                                             |
|-----------------|------------------------------------------------------|
| Değişken Adı    | Sid                                                  |
| Değişken Tanımı | Filtre kademe sırasını belirtmektedir.               |
| Değişken Tipi   | Integer                                              |
| Değişlen Birimi | -                                                    |
| Örnek Veri      | 2                                                    |
